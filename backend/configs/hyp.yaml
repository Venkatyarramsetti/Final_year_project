# Hyperparameters for YOLOv8 Segmentation - Waste Detection Domain
# Optimized for class imbalance, transparent plastics, and mixed waste detection

# Learning rate settings
lr0: 0.001                # Initial learning rate (SGD=1E-2, AdamW=1E-3)
lrf: 0.01                 # Final learning rate (lr0 * lrf)
momentum: 0.937           # SGD momentum/AdamW beta1
weight_decay: 0.0005      # Optimizer weight decay 5e-4

# Warmup settings
warmup_epochs: 3.0        # Warmup epochs (fractions ok)
warmup_momentum: 0.8      # Warmup initial momentum
warmup_bias_lr: 0.1       # Warmup initial bias lr

# Loss weights (tuned for segmentation + detection)
box: 7.5                  # Box loss gain
cls: 0.5                  # Class loss gain (lower for class imbalance)
dfl: 1.5                  # DFL loss gain
pose: 12.0                # Pose loss gain (not used for detection)
kobj: 1.0                 # Keypoint obj loss gain (not used)
seg: 7.5                  # Segmentation loss gain (CRITICAL for plastic bags)

# Class imbalance handling
fl_gamma: 2.0             # Focal loss gamma (0=no focal loss, 2=strong focus on hard examples)
label_smoothing: 0.05     # Label smoothing epsilon (0.0 = off, 0.1 = smooth)

# Augmentation parameters (aggressive for domain robustness)
hsv_h: 0.015              # Image HSV-Hue augmentation (fraction)
hsv_s: 0.7                # Image HSV-Saturation augmentation (fraction)
hsv_v: 0.4                # Image HSV-Value augmentation (fraction)
degrees: 15.0             # Image rotation (+/- deg)
translate: 0.1            # Image translation (+/- fraction)
scale: 0.5                # Image scale (+/- gain)
shear: 2.0                # Image shear (+/- deg)
perspective: 0.0001       # Image perspective (+/- fraction), range 0-0.001
flipud: 0.0               # Image flip up-down (probability)
fliplr: 0.5               # Image flip left-right (probability)

# Mosaic and Mixup (powerful for small datasets)
mosaic: 1.0               # Image mosaic (probability) - combines 4 images into 1
mixup: 0.15               # Image mixup (probability) - blends 2 images
copy_paste: 0.3           # Segment copy-paste (probability) - CRITICAL for synthetic waste

# Augmentation for transparent/thin objects (plastic bags)
erasing: 0.4              # Random erasing probability (simulates occlusion)
crop_fraction: 1.0        # Image crop fraction (0-1) for zoom augmentations

# Training settings
epochs: 150               # Total training epochs (increase to 200+ for production)
patience: 50              # Early stopping patience (epochs without improvement)
batch: 16                 # Batch size (-1 for AutoBatch)
imgsz: 640                # Training image size (use 1280 for high-res inference)
save: True                # Save checkpoints
save_period: -1           # Save checkpoint every x epochs (disabled by -1)
cache: False              # Cache images for faster training (True/ram, False=disk)
device: 0                 # Device to run on (0=GPU, cpu=CPU, 0,1,2,3=multi-GPU)
workers: 8                # Number of dataloader workers
project: outputs          # Project directory
name: waste_yolov8x_seg   # Experiment name

# Validation settings
val: True                 # Validate/test during training
plots: True               # Save plots and images during training
deterministic: True       # Force deterministic algorithms (slower but reproducible)

# Advanced settings
optimizer: AdamW          # Optimizer (SGD, Adam, AdamW, RMSProp)
seed: 42                  # Random seed for reproducibility
close_mosaic: 10          # Disable mosaic last N epochs (stabilize training)

# Logging and tracking
verbose: True             # Verbose output
exist_ok: False           # Overwrite existing project/name
pretrained: True          # Use pretrained model (yolov8x-seg.pt COCO weights)

# Domain-specific notes
notes: |
  KEY OPTIMIZATIONS FOR WASTE DETECTION:
  
  1. CLASS IMBALANCE:
     - fl_gamma=2.0: Focal loss downweights easy negatives (common trash)
     - cls=0.5: Lower class loss weight to prevent overfitting on majority classes
     - Strategy: Upsample hazardous (10x), plastic_bag (5x) with synthetic composites
  
  2. TRANSPARENT PLASTICS:
     - seg=7.5: High segmentation loss weight for precise masks
     - copy_paste=0.3: Copy-paste transparent bag masks onto different backgrounds
     - hsv_v=0.4: Brightness variations simulate lighting through plastic
     - erasing=0.4: Random erasing simulates partially visible bags
  
  3. MIXED FOOD WASTE:
     - mixup=0.15: Blend images to handle mixed/overlapping waste
     - mosaic=1.0: Combines diverse waste items in single image
     - scale=0.5: Handles crushed/deformed containers
  
  4. TRAINING STRATEGY:
     - Start: yolov8x-seg.pt (COCO) → 50 epochs on TACO
     - Finetune: Add 1k synthetic composites → 100 more epochs
     - Polish: Add active learning samples → 50 final epochs
     - Target: mAP@0.5 = 75-85%, hazardous AP > 85%
  
  5. EXPECTED RESULTS:
     - Baseline (COCO weights): mAP ~30-40% (no waste context)
     - TACO only (50 epochs): mAP ~60-70%
     - TACO + synthetics (150 epochs): mAP ~75-85%
     - + Active learning: mAP > 85%, production-ready
